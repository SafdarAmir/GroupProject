<?php
session_start();

$width = 100;
$height = 40;

$image = imagecreatetruecolor($width, $height);

$white = imagecolorallocate($image, 255, 255, 255);
$black = imagecolorallocate($image, 0, 0, 0);

imagefilledrectangle($image, 0, 0, $width, $height, $white);

// Font data
$fontData = [
    "A" => [0, 14, 21, 35, 35, 21, 21, 35],
    "B" => [0, 14, 14, 14, 21, 35, 35, 21, 21, 21, 35, 35, 35, 14, 14, 0],
    "C" => [0, 14, 21, 35, 35, 21, 14],
    "D" => [0, 14, 14, 14, 21, 35, 35, 35, 21, 14, 14, 14, 0],
    "E" => [0, 14, 14, 14, 35, 35, 21, 14, 0, 35, 35, 14, 14, 14, 0],
    "F" => [0, 14, 14, 14, 35, 35, 21, 14, 0, 35, 35, 14, 14, 14, 14, 14],
    "G" => [0, 14, 21, 35, 35, 21, 14, 14, 35, 35, 35, 21, 14],
    "H" => [0, 14, 14, 14, 35, 35, 35, 14, 14, 14, 0],
    "I" => [0, 35, 21, 21, 21, 21, 21, 35, 0],
    "J" => [0, 35, 35, 35, 35, 35, 35, 21, 14, 0],
    "K" => [0, 14, 14, 14, 35, 21, 14, 21, 35, 35, 14, 14, 14, 0],
    "L" => [0, 14, 14, 14, 35, 35, 35, 35, 35, 0],
    "M" => [0, 14, 14, 14, 35, 35, 35, 21, 21, 0],
    "N" => [0, 14, 14, 14, 35, 35, 35, 21, 21, 0],
    "O" => [0, 14, 21, 35, 35, 35, 21, 14, 0],
    "P" => [0, 14, 14, 14, 35, 35, 21, 14, 0, 14, 14, 14, 14, 14],
    "Q" => [0, 14, 21, 35, 35, 35, 21, 14, 0, 0, 21, 21, 35],
    "R" => [0, 14, 14, 14, 35, 35, 21, 14, 0, 14, 14, 14, 14, 21, 35],
    "S" => [0, 14, 21, 14, 14, 21, 35, 35, 21, 14, 0],
    "T" => [0, 35, 21, 21, 21, 21, 21, 21, 21, 0],
    "U" => [0, 14, 35, 35, 35, 35, 35, 21, 14, 0],
    "V" => [0, 14, 35, 35, 35, 35, 21, 14, 0],
    "W" => [0, 14, 35, 35, 35, 35, 35, 21, 21, 0],
    "X" => [0, 14, 35, 21, 21, 14, 35, 35, 21, 21, 0],
    "Y" => [0, 14, 35, 21, 21, 21, 21, 21, 21, 0],
    "Z" => [0, 14, 21, 21, 21, 35, 35, 35, 35, 14, 0],
    "1" => [0, 21, 21, 35, 35, 21, 21, 35, 21, 0],
    "2" => [0, 14, 21, 21, 35, 35, 21, 14, 14, 35, 35, 14, 14, 0],
    "3" => [0, 14, 21, 21, 35, 35, 21, 14, 21, 21, 35, 35, 14, 14, 0],
    "4" => [0, 14, 14, 21, 21, 35, 35, 35, 14, 14, 14, 0],
    "5" => [0, 14, 14, 14, 14, 35, 35, 35, 21, 21, 35, 35, 14, 0],
    "6" => [0, 14, 21, 21, 14, 14, 35, 35, 35, 21, 21, 35, 14, 0],
    "7" => [0, 14, 21, 21, 35, 35, 21, 21, 14, 14, 0],
    "8" => [0, 14, 21, 21, 35, 35, 21, 14, 21, 21, 35, 35, 14, 0],
    "9" => [0, 14, 21, 21, 35, 35, 35, 14, 14, 14, 35, 35, 21, 21, 0],
    "0" => [0, 14, 21, 35, 35, 21, 14, 14, 35, 35, 14, 0],
];

$captchaText = $_SESSION['captcha'];

$x = 10;
$y = 30;

for ($i = 0; $i < strlen($captchaText); $i++) {
    $char = strtoupper($captchaText[$i]);
    $charData = $fontData[$char];
    
    for ($j = 0; $j < count($charData); $j++) {
        if ($charData[$j]) {
            imagefilledrectangle($image, $x + $j, $y, $x + $j + 1, $y - 10, $black);
        }
    }
    
    $x += 20;  // Move to the next character position
}

header('Content-type: image/png');
imagepng($image);
imagedestroy($image);
?>
